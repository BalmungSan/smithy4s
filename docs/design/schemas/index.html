<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Datatypes and schemas | smithy4s</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://disneystreaming.github.io/smithy4s/docs/design/schemas"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Datatypes and schemas | smithy4s"><meta data-react-helmet="true" name="description" content="As stated before, Smithy4s generates code that does not depends on any third-party library."><meta data-react-helmet="true" property="og:description" content="As stated before, Smithy4s generates code that does not depends on any third-party library."><link data-react-helmet="true" rel="icon" href="/smithy4s/img/favicon-32x32.png"><link data-react-helmet="true" rel="canonical" href="https://disneystreaming.github.io/smithy4s/docs/design/schemas"><link data-react-helmet="true" rel="alternate" href="https://disneystreaming.github.io/smithy4s/docs/design/schemas" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://disneystreaming.github.io/smithy4s/docs/design/schemas" hreflang="x-default"><link rel="stylesheet" href="/smithy4s/assets/css/styles.c543be88.css">
<link rel="preload" href="/smithy4s/assets/js/runtime~main.4e8b44af.js" as="script">
<link rel="preload" href="/smithy4s/assets/js/main.c9f5f58c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/smithy4s/"><div class="navbar__logo"><img src="/smithy4s/img/logo.svg" alt="Disney Streaming Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/smithy4s/img/logoDark.svg" alt="Disney Streaming Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">smithy4s</b></a><a class="navbar__item navbar__link navbar__link--active" href="/smithy4s/docs/overview/intro">Get Started</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/disneystreaming/smithy4s" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/overview/intro">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/the-smithy-idl/smithy-idl">The Smithy IDL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/protocols/protocols">Protocols</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/codegen/customisation">Code generation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/smithy4s/docs/design/design">Design</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/smithy4s/docs/design/design">General design principles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/smithy4s/docs/design/schemas">Datatypes and schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/smithy4s/docs/design/services">Services and endpoints</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Datatypes and schemas</h1></header><p>As stated before, Smithy4s generates code that does not depends on any third-party library.
However, we still want to use the generated code with specific serialisation technologies, such as JSON, or Protocol Buffers, or CBOR, MessagePack, XML (yes ... we know).</p><p>We also want to avoid having to implement complex macros to allow for auto-derivation of these things.
For starters, the reality is that maintaining macros across two different Scala versions (2 and 3) is hard work.
Secondly, macros close the door to an interesting feature, namely &quot;dynamic schematisation&quot; that we&#x27;ll describe in another chapter.</p><p>If you have 45 minutes to waste, feel free to go watch the following video where Olivier explained the rationale behind the crazy pattern we are about to explain.
Otherwise, head over below!</p><p><a href="https://www.youtube.com/watch?v=kvBX9u6uRaE" target="_blank" rel="noopener noreferrer"><img src="https://img.youtube.com/vi/kvBX9u6uRaE/0.jpg" alt="Revisiting visitors"></a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="the-schema-gadt">The Schema GADT<a class="hash-link" href="#the-schema-gadt" title="Direct link to heading">â€‹</a></h2><p>Each datatype generated by Smithy4s is accompanied by a <code>schema</code> value in its companion object, which contains an expression of type <code>smithy4s.schema.Schema</code> that captures everything needed to deconstruct/reconstruct instances of the datatype.</p><p><code>smithy4s.schema.Schema</code> is a Generalised Algebraic Datatype (or GADT for short) that can be used to precisely reference all the information needed to traverse datatypes that can be expressed in Smithy.
It is a bit like JVM reflection, except that it exposes higher-level information about the datatypes. It achieves this by exposing building blocks that accurately reflect what is possible to express in the Smithy language.
These building blocks form a <strong>metamodel</strong>: a model for models. And, unlike JVM reflection, using schemas is type-safe.</p><p>The <code>Schema</code> type reflects the various ways of constructing datatypes in Smithy.
It is encoded as a sealed trait, the members of which capture the following aspects of the Smithy language:</p><ul><li>Primitives</li><li>Lists</li><li>Sets</li><li>Maps</li><li>Enumerations</li><li>Structures</li><li>Unions</li></ul><p>For a Scala type called <code>Foo</code>, formulating a <code>Schema[Foo]</code> is equivalent to exhaustively capturing the information needed for the serialisation and deserialisation of <code>Foo</code> in any format (JSON, XML, ...). Indeed, for any <code>Codec[_]</code> construct provided by third-party libraries, it is possible to write a generic <code>def compile(schema: Schema[A]): Codec[A]</code> function that produces the <code>Codec</code> for <code>A</code> based on the information held by the <code>Schema</code>.</p><p>Why do things this way? Why not just render <code>Codec</code> during code generation?
The reason is that we want for the generated code to be completely decoupled from any serialisation format or library, and for the user to have the ability to wire that generated code in different ways, without having to change anything in the build.
Moreover, this approach has proven that it allows for a bounded investment for adding interop with various libraries, and offers really good testability.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="hints">Hints<a class="hash-link" href="#hints" title="Direct link to heading">â€‹</a></h3><p>In Smithy, all shapes (and members of composite shapes) can be annotated with <strong>traits</strong>. Smithy4s generically translates these annotations to instances of the corresponding generated classes, which means that Smithy4s supports generating user defined traits that it has zero knowledge of.</p><p>So if you have the following Smithy description:</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">namespace example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@trait</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure metadata {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@metadata(description: &quot;This is my own integer shape&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">integer MyInt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>When processing this Smithy model, Smithy4s renders a <code>case class Metadata(description: String)</code>, with an assocaited <code>ShapeTag[Metadata]</code> instance, and the following expression in the companion object of <code>MyInt</code>:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">val hints = Hints(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Metadata(&quot;this is my own integer shape&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>smithy4s.Hints</code> type is a polymorphic map that can hold shapes, keyed by <code>ShapeTag</code>.
A <code>ShapeTag</code> is a uniquely identified tag that uses referential equality.
Every schema can hold a <code>Hints</code> instance, which means that in addition to the datatype structures, Schemas also offer an accurate reflection of the trait values that annotate shapes in the smithy models.</p><p>Smithy4s uses these hints to implement interpreters.
For instance, the <code>smithy.api#jsonName</code> smithy trait translates to a <code>smithy.api.JsonName</code> Scala type, that we can query from a <code>Hints</code> instance when implementing a <code>Schema ~&gt; JsonCodec</code> transformation.
This allows to give users a little customisability in the json serialisation of their datatypes.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="structures">Structures<a class="hash-link" href="#structures" title="Direct link to heading">â€‹</a></h3><p>A structure, also referred to as product, or record, is a construct that groups several values together.
Typically, it translates naturally to a case class.</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">namespace example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure Foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  a: Integer,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @length(min: 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>...and the associated, generated Scala code:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">package example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import smithy4s.schema.Schema._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class Foo(a: Int, b: Option[String] = None)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Foo extends smithy4s.ShapeTag.Companion[Foo] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val id: smithy4s.ShapeId = smithy4s.ShapeId(&quot;example&quot;, &quot;Foo&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  implicit val schema: smithy4s.Schema[Foo] = struct(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int.required[Foo](&quot;a&quot;, _.a),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string.optional[Foo](&quot;b&quot;, _.b).addHints(smithy.api.Length(Some(1), None))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Foo.apply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.withId(id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As you can see, the Smithy <strong>structure</strong> translates quite naturally to a Scala <code>case class</code>.
Every member of the structure that does not have the <code>@required</code> trait is rendered as an optional value defaulting to None (by default, smithy4s sorts the fields before rendering the case class so that the required ones appear before the optional ones. That is a pragmatic decision that tends to improve UX for users.)</p><p>Indeed, for each field, there is an associated reference to a schema (int, string, ...), a string label, and a lambda calling the case class accessor that allows the retrieval of the associated field value.
Additionally, the constructor of the case class is also referenced in the Schema.</p><p>Typically, the accessors are needed for encoding the data, which involves destructuring it to access its individual components.
The labels are there to cater to serialisation mechanisms like JSON or XML, where sub-components of a piece of data are labelled and nested under a larger block.</p><p>Conversely, the constructor is used for deserialisation, which involves reconstructing the data after all of its component values have been successfully deserialised.</p><p>Another detail is the presence of the <code>addHints</code> call on field labelled with <code>b</code>. This is due to the presence of the <code>length</code> trait (from the <code>smithy.api</code> namespace, aka the prelude) on the corresponding <code>b</code> member of the smithy <code>Foo</code> shape.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="note-related-to-optional-and-required">Note related to <code>optional</code> and <code>required</code><a class="hash-link" href="#note-related-to-optional-and-required" title="Direct link to heading">â€‹</a></h4><p>You may have noticed the <code>required</code> and <code>optional</code> methods, which create <code>Field</code> instances from <code>Schemas</code>, in order to pass them to structures.
In Smithy4s, the concept of <code>Option</code> only exists relatively to <code>struct</code> calls. It is not possible to construct a <code>Schema[Option[A]]</code> on its own.</p><p>The rationale is that having a first class <code>Option</code> schema constructor leads to leaks in the implementation of serialisation mechanisms, as <code>None</code> typically represents the absence of value, and allowing for serialising an absence of value in formats that typically do not support it implies the leak of <code>Option</code> (or equivalent) in various interfaces.</p><p>Additionally, a first class <code>Option</code> schema constructor would allow to create schemas for <code>Option[Option[Option[Int]]]</code>, and even though we recognise that
there are some things that could be encoded this way, it is just not a very pragmatic possibility, and opens the door for easy violation of round-trip properties that any serialisation technology should respect.
For instance: <code>Some(None)</code> and <code>None</code> can easily have the same encoding in Json, so how do you distinguish between the two during decoding?</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="unions">Unions<a class="hash-link" href="#unions" title="Direct link to heading">â€‹</a></h3><p>Union, also referred to as coproduct, or sum type, is a construct that expresses sealed polymorphism. It is the dual of a structure:
when structures express that you have <strong>A AND B</strong>, unions express that you can have <strong>A OR B</strong>.</p><p>The way this is expressed in Smithy looks like this:</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">namespace example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">union Bar {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  a: Integer,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This hints at the default serialisation that AWS has intended to use on unions expressed in smithy, namely <strong>tagged unions</strong>.
Indeed, the AWS json-centric protocols specifies that shapes like these should be serialised in objects with a single key/value entry, where the key receives the value of the tag. For instance, <code>{ &quot;a&quot; : 1 }</code> or <code>{ &quot;b&quot; : &quot;two&quot; }</code>.
There are some very relevant technical reasons for it, but this way of encoding unions/co-products in JSON is arguably the best.
It may also be familiar to <a href="https://circe.github.io/circe/" target="_blank" rel="noopener noreferrer">Circe</a> users as it&#x27;s the default encoding of co-products in circe-generic.</p><p>Regarding the Scala code rendered by Smithy4s for the above Smithy specification, it looks like this:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">package example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import smithy4s.schema.Schema._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealed trait Bar extends scala.Product with scala.Serializable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Bar extends smithy4s.ShapeTag.Companion[Bar] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val id: smithy4s.ShapeId = smithy4s.ShapeId(&quot;foobar&quot;, &quot;Bar&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case class ACase(a: Int) extends Bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case class BCase(b: String) extends Bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  object ACase {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val hints : smithy4s.Hints = smithy4s.Hints.empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val schema: smithy4s.Schema[ACase] = bijection(int.addHints(hints), ACase(_), _.a)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val alt = schema.oneOf[Bar](&quot;a&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  object BCase {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val hints : smithy4s.Hints = smithy4s.Hints.empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val schema: smithy4s.Schema[BCase] = bijection(string.addHints(hints), BCase(_), _.b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val alt = schema.oneOf[Bar](&quot;b&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  implicit val schema: smithy4s.Schema[Bar] = union(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ACase.alt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BCase.alt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case c : ACase =&gt; ACase.alt(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case c : BCase =&gt; BCase.alt(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.withId(id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>union</code> is rendered as an ADT (<code>sealed trait</code>), the members of which are single-value case classes wrapping values of the types referenced
by the <code>union</code> member.
The <code>Case</code> suffix is added as a way to reduce risk of collision between the generated code and other types (especially the types being wrapped).</p><p>Each ADT member is accompanied by its own schema, which is <strong>not</strong> provided implicitly, in an effort to retain coherence in the type-class instances,
and avoid the situation where you&#x27;d have different behaviours during serialisation based on whether you&#x27;ve up-casted a member to the ADT.
Additionally, the companion objects of each ADT members contain an <code>alt</code> value (for &quot;alternative&quot;), which is the union&#x27;s equivalent to the structure&#x27;s <code>field</code>.</p><p>Much like a <code>field</code>, an <code>alt</code> contains a label, and can carry hints. But unlike a <code>field</code>, which contains an accessor, the <code>alt</code> contains the function to &quot;inject&quot; (up-cast) the member into the union.
This is useful for de-serialisation, when, after successfully de-serialising a member of a union, you need to inject it into the ADT to return the expected type.</p><p>As for the union&#x27;s schema, it is somewhat similar to the structure&#x27;s, in that it references all its alternatives.
But instead of a structure&#x27;s constructor, we have a dispatch function instead, which contains a pattern match against all the possible members, and dispatches the &quot;down-casted&quot; value to its corresponding alternative.
This is useful for serialisation, when the behaviour of the alternatives can only be applied to values of the corresponding type: &quot;if my ADT is an A, then I serialise the A, and add a discriminating tag to the serialised A&quot;.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="named-simple-shapes">Named simple shapes<a class="hash-link" href="#named-simple-shapes" title="Direct link to heading">â€‹</a></h3><p>Smithy allows for the creation of named shapes that reference &quot;primitive types&quot;:</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">namespace example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">integer MyInt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Smithy4s translates this to a Scala <strong>newtype</strong> : a zero-overhead wrapper for the underling type (in this case, <code>Int</code>):</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">package example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object MyInt extends Newtype[Int] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val id: smithy4s.ShapeId = smithy4s.ShapeId(&quot;foobar&quot;, &quot;MyInt&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val hints : smithy4s.Hints = smithy4s.Hints.empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val underlyingSchema : smithy4s.Schema[Int] = int.withId(id).addHints(hints)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  implicit val schema : smithy4s.Schema[MyInt] = bijection(underlyingSchema, MyInt(_), (_ : MyInt).value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A <code>MyInt</code> type alias, pointing to the <code>MyInt.Type</code> type member, is rendered in the <code>example</code> package object, which makes it possible to write
such code:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">val myInt: MyInt = MyInt(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// val int: Int = myInt // doesn&#x27;t compile because MyInt is not an Int at compile time.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val int: Int = myInt.value</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You may have noticed that the <code>schema</code> value is using <code>bijection</code>. Additionally to the GADT members stated previously, <code>Schema</code> also has a <code>BijectionSchema</code> member, which allows to apply bidirectional transformation on other Schemas.
This is useful for the case of newtypes: if we are able to derive a codec that can encode and decode <code>Int</code>, it should be possible to derive a codec that encodes and decodes <code>MyInt</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="collections">Collections<a class="hash-link" href="#collections" title="Direct link to heading">â€‹</a></h3><p>Smithy supports three types of collections out of the box :</p><ul><li>set (bound to disappear in smithy 2.0 in favour of the <code>@uniqueItems</code> trait)</li><li>list</li><li>map</li></ul><p>Additionally, Smithy4s allows users to <a href="/smithy4s/docs/codegen/customisation">annotate list shapes</a> to customise the type of collection used during code-generation.</p><p>Smithy does not support generics, therefore all collection are named. Though seemingly tedious, it makes it easier to build tooling
(and probably helps languages that do not support generics). Provided the following shape :</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">namespace example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">list IntList {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  member: Integer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You get the following Scala code :</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">package example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object IntList extends Newtype[List[Int]] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val id: smithy4s.ShapeId = smithy4s.ShapeId(&quot;example&quot;, &quot;IntList&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val hints : smithy4s.Hints = smithy4s.Hints.empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val underlyingSchema : smithy4s.Schema[List[Int]] = list(int).withId(id).addHints(hints)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  implicit val schema : smithy4s.Schema[IntList] = bijection(underlyingSchema, IntList(_), (_ : IntList).value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It is really similar to named primitives. <strong>However</strong>, for pragmatic reasons, when a structure references a collection in one of its members, the Scala field gets rendered using the de-aliased type (as opposed to the newtype). The <code>IntList</code> newtype is generated mostly as a way to hold the hints and schemas
corresponding to the smithy <code>IntList</code> shape. Additionally, the <code>IntList</code> newtype is used by Smithy4s to render <code>Hints</code> values :</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">namespace example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@trait</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">list info {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  member: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@info(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure A {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>would lead to the following code being rendered in the companion object of <code>A</code> :</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">val hints : Hints = Hints(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  example.Info(List(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This allows to query Hints for <code>Info</code> using the following syntax: <code>hints.get(example.Info)</code></p><p>Regarding the <code>underlyingSchema</code> value in the companion object of <code>IntList</code>, you can see that it is constructed using a <code>list</code> function. Conceptually, it encodes this : &quot;if I&#x27;m able to encode or decode an <code>A</code> in a specific format, then I should be able to encode or decode a <code>List[A]</code>&quot;.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="enumerations">Enumerations<a class="hash-link" href="#enumerations" title="Direct link to heading">â€‹</a></h3><p><strong>TODO</strong> (waiting for smithy 2.0 which changes the syntax)</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/disneystreaming/smithy4s/edit/main/modules/docs/src/05-design/02-schemas.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/smithy4s/docs/design/design"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">General design principles</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/smithy4s/docs/design/services"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Services and endpoints</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-schema-gadt" class="table-of-contents__link toc-highlight">The Schema GADT</a><ul><li><a href="#hints" class="table-of-contents__link toc-highlight">Hints</a></li><li><a href="#structures" class="table-of-contents__link toc-highlight">Structures</a></li><li><a href="#unions" class="table-of-contents__link toc-highlight">Unions</a></li><li><a href="#named-simple-shapes" class="table-of-contents__link toc-highlight">Named simple shapes</a></li><li><a href="#collections" class="table-of-contents__link toc-highlight">Collections</a></li><li><a href="#enumerations" class="table-of-contents__link toc-highlight">Enumerations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/smithy4s/docs/overview/intro">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/disneystreaming/smithy4s" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Disney Streaming</div></div></div></footer></div>
<script src="/smithy4s/assets/js/runtime~main.4e8b44af.js"></script>
<script src="/smithy4s/assets/js/main.c9f5f58c.js"></script>
</body>
</html>