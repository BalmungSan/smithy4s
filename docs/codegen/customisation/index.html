<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Customisation | smithy4s</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://disneystreaming.github.io/smithy4s/docs/codegen/customisation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Customisation | smithy4s"><meta data-react-helmet="true" name="description" content="Smithy4s is opinionated in what the generated code look like, there are a few things that can be tweaked."><meta data-react-helmet="true" property="og:description" content="Smithy4s is opinionated in what the generated code look like, there are a few things that can be tweaked."><link data-react-helmet="true" rel="icon" href="/smithy4s/img/favicon-32x32.png"><link data-react-helmet="true" rel="canonical" href="https://disneystreaming.github.io/smithy4s/docs/codegen/customisation"><link data-react-helmet="true" rel="alternate" href="https://disneystreaming.github.io/smithy4s/docs/codegen/customisation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://disneystreaming.github.io/smithy4s/docs/codegen/customisation" hreflang="x-default"><link rel="stylesheet" href="/smithy4s/assets/css/styles.27d6adb7.css">
<link rel="preload" href="/smithy4s/assets/js/runtime~main.a8e5752f.js" as="script">
<link rel="preload" href="/smithy4s/assets/js/main.2e4c1298.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/smithy4s/"><div class="navbar__logo"><img src="/smithy4s/img/logo.svg" alt="Disney Streaming Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/smithy4s/img/logoDark.svg" alt="Disney Streaming Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">smithy4s</b></a><a class="navbar__item navbar__link navbar__link--active" href="/smithy4s/docs/overview/intro">Get Started</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/disneystreaming/smithy4s" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/overview/intro">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/the-smithy-idl/smithy-idl">The Smithy IDL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/protocols/protocols">Protocols</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/smithy4s/docs/codegen/customisation">Code generation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/smithy4s/docs/codegen/customisation">Customisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/smithy4s/docs/codegen/unions">Unions and sealed traits</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/design/design">Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/smithy4s/docs/guides/extract-request-info">Guides</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Customisation</h1></header><p>Smithy4s is opinionated in what the generated code look like, there are a few things that can be tweaked.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="packed-inputs">Packed inputs<a class="hash-link" href="#packed-inputs" title="Direct link to heading">â€‹</a></h2><p>By default, Smithy4s generates methods the parameters of which map to the fields of the input structure of the corresponding operation.</p><p>For instance :</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">service PackedInputsService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operations: [PackedInputOperation]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">operation PackedInputOperation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  input: PackedInput,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure PackedInput {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>leads to something conceptually equivalent to :</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">trait PackedInputServiceGen[F[_]] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def packedInputOperation(a: String, b: String) : F[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It is however possible to annotate the service (or operation) definition with the <code>smithy4s.meta#packedInputs</code> trait, in order for the rendered method to contain a single parameter, typed with actual input case class of the operation.</p><p>For instance :</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">use smithy4s.meta#packedInputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@packedInputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service PackedInputsService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operations: [PackedInputOperation]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>will produce the following Scala code</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">trait PackedInputServiceGen[F[_]] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def packedInputOperation(input: PackedInput) : F[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="adt-member-trait">ADT Member Trait<a class="hash-link" href="#adt-member-trait" title="Direct link to heading">â€‹</a></h2><p>The default behavior of Smithy4s when rendering unions that target structures is to render the structure
in a separate file from the union that targets it. This makes sense if the structure is used in other
contexts other than the union. However, it also causes an extra level of nesting within the union.
This is because the union will create another case class to contain your structure case class.</p><p>For example:</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">union OrderType {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inStore: InStoreOrder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure InStoreOrder {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: OrderNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    locationId: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Would render the following scala code:</p><p>OrderType.scala:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">sealed trait OrderType extends scala.Product with scala.Serializable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class InStoreCase(inStore: InStoreOrder) extends OrderType</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>InStoreOrder.scala:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">case class InStoreOrder(id: OrderNumber, locationId: Option[String] = None)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The sealed hierarchy <code>OrderType</code> has a member named <code>InStoreCase</code>. This is because
<code>InStoreOrder</code> is rendered in a separate file and <code>OrderType</code> is sealed.</p><p>However, adding the <code>adtMember</code> trait to the <code>InStoreOrder</code> structure changes this.</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">union OrderType {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inStore: InStoreOrder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@adtMember(OrderType) // added the adtMember trait here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure InStoreOrder {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: OrderNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    locationId: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">sealed trait OrderType extends scala.Product with scala.Serializable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class InStoreOrder(id: OrderNumber, locationId: Option[String] = None) extends OrderType</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>IsStoreOrder</code> class has now been updated to be rendered directly as a member of the <code>OrderType</code>
sealed hierarchy.</p><p><em>The <code>adtMember</code> trait can be applied to any structure as long as said structure is targeted by EXACTLY ONE union.</em>
This means it must be targeted by the union that is provided as parameter to the adtMember trait.
This constraint is fulfilled above because <code>OrderType</code> targets <code>InStoreOrder</code> and <code>InStoreOrder</code> is
annotated with <code>@adtMember(OrderType)</code>.
The structure annotated with <code>adtMember</code> (e.g. <code>InStoreOrder</code>) also must not be targeted by any other
structures or unions in the model. There is a validator that will make sure these requirements are met
whenever the <code>adtMember</code> trait is in use.</p><p>Note: The <code>adtMember</code> trait has NO impact on the serialization/deserialization behaviors of Smithy4s.
The only thing it changes is what the generated code looks like. This is accomplished by keeping the
rendered schemas equivalent, even if the case class is rendered in a different place.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="specialized-collection-types">Specialized collection types<a class="hash-link" href="#specialized-collection-types" title="Direct link to heading">â€‹</a></h2><p>Smithy supports <code>list</code> and <code>set</code>, Smithy4s renders that to <code>List[A]</code> and <code>Set[A]</code> respectively. You can also use the <code>@uniqueItems</code> annotation on <code>list</code> which is equivalent to <code>set</code>.</p><p>Smithy4s has support for two specialized collection types: <code>Vector</code> and <code>IndexedSeq</code>. The following examples show how to use them:</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">use smithy4s.meta#indexedSeq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use smithy4s.meta#vector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@indexedSeq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">list SomeIndexSeq {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  member: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@vector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">list SomeVector {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  member: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Both annotations are only applicable on <code>list</code> shapes. You can&#x27;t mix <code>@vector</code> with <code>@indexedSeq</code>, and neither one can be used with <code>@uniqueItems</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="refinements">Refinements<a class="hash-link" href="#refinements" title="Direct link to heading">â€‹</a></h2><p>Refinements provide a mechanism for using types that you control inside the code generated by smithy4s. Creating a refinement for use in your application starts with creating a custom smithy trait that represents the refinement.</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">namespace test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@trait(selector: &quot;string&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure emailFormat {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This trait can now be used on <code>string</code> shapes to indicate that they must match an email format.</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@emailFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string Email</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now we need to tell smithy4s that we want to represent shapes annotated with <code>@emailFormat</code> as a custom type that we define.</p><p>Given a custom email type such as:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">// Note, we recommend using a newtype library over a regular case class in most cases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// But this is shown to simplify the example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class Email(value: String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Email {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private def isValidEmail(value: String): Boolean = ???</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def apply(value: String): Either[String, Email] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (isValidEmail(value)) Right(new Email(value))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else Left(&quot;Email is not valid&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, we will need to provide a way for smithy4s to understand how to construct and deconstruct our <code>Email</code> type. We do this by defining an instance of a <code>RefinementProvider</code>. Note that the <code>RefinementProvider</code> we create MUST be <code>implicit</code>.</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">// package myapp.types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import smithy4s._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class Email(value: String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Email {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private def isValidEmail(value: String): Boolean = ???</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def apply(value: String): Either[String, Email] =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (isValidEmail(value)) Right(new Email(value))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else Left(&quot;Email is not valid&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  implicit val provider = Refinement.drivenBy[EmailFormat](</span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    Email.apply, // Tells smithy4s how to create an Email (or get an error message) given a string</span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    (e: Email) =&gt; e.value // Tells smithy4s how to get a string from an Email</span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The <code>EmailFormat</code> type passed as a type parameter to <code>Refinement.drivenBy</code> is the type that smithy4s generated from our <code>@emailFormat</code> trait we defined in our smithy file earlier.</p></div></div><p>Now, we just have one thing left to do: tell smithy4s where to find our custom <code>Email</code> type. We do this using a trait called <code>smithy4s.meta#refinement</code>.</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">use smithy4s.meta#refinement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apply test#emailFormat @refinement(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  targetType: &quot;myapp.types.Email&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here we are applying the refinement trait to our <code>emailFormat</code> trait we defined earlier. We are providing the <code>targetType</code> which is our <code>Email</code> case class we defined. </p><p>Smithy4s will now be able to update how it does code generation to reference our custom <code>Email</code> type.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>If the provider was not in the companion object of our <code>targetType</code>, we would need to provide the <code>providerImport</code> to the <code>refinement</code> trait
so that smithy4s would be able to find it. For example:</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">use smithy4s.meta#refinement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apply test#emailFormat @refinement(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  targetType: &quot;myapp.types.Email&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  providerImport: &quot;myapp.types.providers._&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Whether the provider is in the companion object or not, it must be <code>implicit</code>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="unwrapping">Unwrapping<a class="hash-link" href="#unwrapping" title="Direct link to heading">â€‹</a></h2><p>By default, smithy4s will wrap all standalone primitive types in a Newtype. A standalone primitive type is one that is defined like the following:</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">string Email // standalone primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  email: Email,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  other: String // not a standalone primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Given this example, smithy4s would generate something like the following:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">final case class Test(email: Email, other: String)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This wrapping may be undesirable in some circumstances. As such, we&#x27;ve provided the <code>smithy4s.meta#unwrap</code> trait. This trait tells the smithy4s code generation to not wrap these types in a newtype when they are used.</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">use smithy4s.meta#unwrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@unwrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string Email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  email: Email,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  other: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This would now generate something like:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">final case class Test(email: String, other: String)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This can be particularly useful when working with refinement types (see above for details on refinements). By default, any type that is <code>refined</code> will be generated inside of a newtype. If you don&#x27;t want this, you can mark the type with the <code>unwrap</code> trait.</p><div class="codeBlockContainer_J+bg language-kotlin theme-code-block"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@trait(selector: &quot;string&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">structure emailFormat {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@emailFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@unwrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string Email</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>By default, smithy4s renders collection types as unwrapped EXCEPT when the collection has been refined. In this case, the collection will be rendered within a newtype by default. If you wish your refined collection be rendered unwrapped, you can accomplish this using the same <code>@unwrap</code> trait annotation on it.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/disneystreaming/smithy4s/edit/main/modules/docs/src/04-codegen/01-customisation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/smithy4s/docs/protocols/aws/aws"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">AWS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/smithy4s/docs/codegen/unions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Unions and sealed traits</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#packed-inputs" class="table-of-contents__link toc-highlight">Packed inputs</a></li><li><a href="#adt-member-trait" class="table-of-contents__link toc-highlight">ADT Member Trait</a></li><li><a href="#specialized-collection-types" class="table-of-contents__link toc-highlight">Specialized collection types</a></li><li><a href="#refinements" class="table-of-contents__link toc-highlight">Refinements</a></li><li><a href="#unwrapping" class="table-of-contents__link toc-highlight">Unwrapping</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/smithy4s/docs/overview/intro">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/disneystreaming/smithy4s" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Disney Streaming</div></div></div></footer></div>
<script src="/smithy4s/assets/js/runtime~main.a8e5752f.js"></script>
<script src="/smithy4s/assets/js/main.2e4c1298.js"></script>
</body>
</html>